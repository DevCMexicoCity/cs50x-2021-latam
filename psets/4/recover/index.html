<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property="og:description" content="Harvard Universty's introduction to the intellectual enterprises of computer science and the art of programming.">

<meta property="og:image" content="https://img.youtube.com/vi/zYierUhIFNQ/maxresdefault.jpg"><meta property="og:title" content="Recover - CS50x 2021"><link href="../../../favicon.ico%3F1610389211" rel="icon">

<!-- https://fonts.google.com/specimen/PT+Sans?query=PT+Sans&selection.family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700 -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>

<!-- http://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
<script src="../../../assets/jquery/dist/jquery.min.js%3F1610389211"></script>
<script src="../../../assets/bootstrap/dist/js/bootstrap.bundle.min.js%3F1610389211"></script>

<!-- https://bootstrap-table.com/docs/getting-started/introduction/ -->
<link href="../../../assets/bootstrap-table/dist/bootstrap-table.min.css%3F1610389211.css" rel="stylesheet">
<script src="../../../assets/bootstrap-table/dist/bootstrap-table.min.js%3F1610389211"></script>
<script src="../../../assets/bootstrap-table/dist/extensions/mobile/bootstrap-table-mobile.min.js%3F1610389211"></script>

<!-- https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use -->
<link href="../../../assets/@fortawesome/fontawesome-free/css/all.min.css%3F1610389211.css" rel="stylesheet">

<!-- https://moment.github.io/luxon/ -->
<script src="../../../assets/luxon.min.js%3F1610389211"></script>

<!-- http://docs.mathjax.org/ -->
<!-- https://www.jsdelivr.com/package/npm/mathjax?path=es5 -->
<script crossorigin="anonymous" integrity="sha256-+nfSJ1LiSvANSK3wvi6FjM+oFwoIQvURU1frozp5z6o=" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-chtml.js"></script>

<!-- https://github.com/verlok/vanilla-lazyload -->
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.7.0/intersection-observer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.3.0/dist/lazyload.min.js"></script>



<link href="../../../assets/page.css%3F1610389211.css" rel="stylesheet">
<script src="../../../assets/jekyll-theme-cs50.js%3F1610389211"></script>

<script>
    window.CS50 = {
        locale: "en",
        tz: "America/New_York"
    };
</script>

<title>Recover - CS50x 2021</title>
</head>

    <body class="invisible">

        
        
        
        <div class="alert alert-dismissible fixed-top mb-0 rounded-0 shadow" data-alert="success" id="alert" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">√ó</span>
            </button><p>This is CS50x 2021, the newest version of the course. Looking for <a href="https://cs50.harvard.edu/x/2020/">CS50x 2020</a>?</p></div>
        
        

        <div class="container-fluid">

            <div class="row">

                <aside class="col-md">
 
                    <header><h1 data-id="this-is-cs50x"><a href="../../../index.html">This is CS50x</a></h1>

<p>OpenCourseWare</p>

<p><a href="https://community.alumni.harvard.edu/give/59206872" class="pr-1 small">Donate</a>
<a href="https://community.alumni.harvard.edu/give/59206872" class="small"><i aria-hidden="true" class="fas fa-external-link-alt"></i></a></p>

<p><a href="https://cs.harvard.edu/malan/">David J. Malan</a><br>
<a href="mailto:malan@harvard.edu">malan@harvard.edu</a><br>
<a href="https://www.facebook.com/dmalan" class="mr-2"><i class="fab fa-facebook-f"></i></a><a href="https://github.com/dmalan" class="mr-2"><i class="fab fa-github"></i></a><a href="https://www.instagram.com/davidjmalan/" class="mr-2"><i class="fab fa-instagram"></i></a><a href="https://www.linkedin.com/in/malan/" class="mr-2"><i class="fab fa-linkedin"></i></a><a href="https://www.quora.com/profile/David-J-Malan" class="mr-2"><i class="fab fa-quora"></i></a><a href="https://www.reddit.com/user/davidjmalan" class="mr-2"><i class="fab fa-reddit-alien"></i></a><a href="https://twitter.com/davidjmalan" class="mr-2"><i class="fab fa-twitter"></i></a></p></header>

                    

                    <button aria-controls="nav" aria-expanded="false" class="btn btn-sm collapsed d-md-none" data-target="aside > nav" data-toggle="collapse">
                        Menu
                    </button>

                    <nav class="collapse d-md-block" id="nav"><hr>

<ul>
  <li data-marker="*"><a href="../../../seminars/index.html">CS50‚Äôs New Year‚Äôs Seminars</a> <span class="text-white">ü•Ç</span></li>
  <li data-marker="*"><a href="../../../gallery/index.html">Gallery of Final Projects</a> <span class="pl-1 text-white">üñºÔ∏è </span></li>
  <li data-marker="*"><a href="../../../new/index.html">What‚Äôs new for 2021?</a></li>
</ul>
<ul>
  <li data-marker="*"><a href="../../../weeks/0/index.html">Week 0</a> Scratch</li>
  <li data-marker="*"><a href="../../../weeks/1/index.html">Week 1</a> C</li>
  <li data-marker="*"><a href="../../../weeks/2/index.html">Week 2</a> Arrays</li>
  <li data-marker="*"><a href="../../../weeks/3/index.html">Week 3</a> Algorithms</li>
  <li data-marker="*"><a href="../../../weeks/4/index.html">Week 4</a> Memory</li>
  <li data-marker="*"><a href="../../../weeks/5/index.html">Week 5</a> Data Structures</li>
  <li data-marker="*"><a href="../../../weeks/6/index.html">Week 6</a> Python</li>
  <li data-marker="*"><a href="../../../weeks/7/index.html">Week 7</a> SQL</li>
  <li data-marker="*"><a href="../../../weeks/8/index.html">Week 8</a> HTML, CSS, JavaScript</li>
  <li data-marker="*"><a href="../../../weeks/9/index.html">Week 9</a> Flask</li>
  <li data-marker="*"><a href="../../../weeks/10/index.html">Week 10</a> Ethics</li>
</ul>
<ul>
  <li data-marker="*" class="small"><a href="../../../weeks/security/index.html">Security</a></li>
  <li data-marker="*" class="small"><a href="../../../weeks/ai/index.html">Artificial Intelligence</a></li>
</ul>
<ul>
  <li data-marker="*"><a href="../../../project/index.html">Final Project</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../../honesty/index.html">Academic Honesty</a></li>
  <li data-marker="*"><a href="../../../certificate/index.html">CS50 Certificate</a></li>
  <li data-marker="*"><a href="../../../faqs/index.html">FAQs</a></li>
  <li data-marker="*"><a href="https://cs50.me/cs50x">Gradebook</a></li>
  <li data-marker="*"><a href="../../../staff/index.html">Staff</a></li>
  <li data-marker="*"><a href="../../../syllabus/index.html">Syllabus</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="https://cs50.harvard.edu/x/ed">Ed Discussion</a> for Q&amp;A</li>
  <li data-marker="*" class="small"><a href="https://us.edstem.org/quickstart/ed-discussion.pdf">Quick Start Guide</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://cs50.edx.org/">edX</a></li>
  <li data-marker="*"><a href="https://www.youtube.com/playlist?list=PLhQjrBD2T382_R182iC2gNZI9HzWFMC_8">YouTube</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://ide.cs50.io/">CS50 IDE</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/css/">CSS Tutorial</a></li>
  <li data-marker="*"><a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/">Flask Quickstart</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/html/">HTML Tutorial</a></li>
  <li data-marker="*"><a href="https://jinja.palletsprojects.com/en/2.11.x/templates/">Jinja Template Designer Documentation</a></li>
  <li data-marker="*"><a href="https://man.cs50.io/">Manual Pages</a></li>
  <li data-marker="*"><a href="https://docs.python.org/3.7/search.html">Python Documentation</a></li>
  <li data-marker="*"><a href="https://scratch.mit.edu/">Scratch</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/sql/">SQL Tutorial</a></li>
  <li data-marker="*"><a href="https://cs50.readthedocs.io/style/c/">Style Guide</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://cs50.noticeable.io/">Changelog</a></li>
  <li data-marker="*"><a href="https://cs50.statuspage.io/">Status Page</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../../communities/index.html">Communities</a></li>
  <li data-marker="*" class="small"><a href="https://discord.gg/cs50">Discord</a></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/groups/cs50/">Facebook Group</a></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/cs50/">Facebook Page</a></li>
  <li data-marker="*" class="small"><a href="https://github.com/cs50">GitHub</a></li>
  <li data-marker="*" class="small"><a href="https://gitter.im/cs50/x">Gitter</a></li>
  <li data-marker="*" class="small"><a href="https://instagram.com/cs50">Instagram</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/groups/7437240/">LinkedIn Group</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/school/CS50/">LinkedIn Page</a></li>
  <li data-marker="*" class="small"><a href="https://www.quora.com/topic/CS50">Quora</a></li>
  <li data-marker="*" class="small"><a href="https://www.reddit.com/r/cs50/">Reddit</a></li>
  <li data-marker="*" class="small"><a href="https://cs50.edx.org/slack">Slack</a></li>
  <li data-marker="*" class="small"><a href="https://www.snapchat.com/add/cs50">Snapchat</a></li>
  <li data-marker="*" class="small"><a href="https://soundcloud.com/cs50">SoundCloud</a></li>
  <li data-marker="*" class="small"><a href="https://twitter.com/cs50">Twitter</a></li>
  <li data-marker="*" class="small"><a href="http://www.youtube.com/subscription_center?add_user=cs50tv">YouTube</a></li>
</ul>

<hr>

<p><a href="https://cs50.harvardshop.com/"><img src="https://i.imgur.com/GGMdcKt.png" alt="Harvard Shop"></a></p>

<hr>

<p><a href="../../../license/index.html" class="small"><i class="fab fa-creative-commons mr-1"></i>License</a></p></nav>

                    <footer></footer>

                </aside>

                <main class="col-md">

                    <h1 id="recover">Recover</h1>

<p>Implement a program that recovers JPEGs from a forensic image, per the below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recover card.raw
</code></pre></div></div>

<h2 id="background">Background</h2>

<p>In anticipation of this problem, we spent the past several days taking photos of people we know, all of which were saved on a digital camera as JPEGs on a memory card. (Okay, it‚Äôs possible we actually spent the past several days on Facebook instead.) Unfortunately, we somehow deleted them all! Thankfully, in the computer world, ‚Äúdeleted‚Äù tends not to mean ‚Äúdeleted‚Äù so much as ‚Äúforgotten.‚Äù Even though the camera insists that the card is now blank, we‚Äôre pretty sure that‚Äôs not quite true. Indeed, we‚Äôre hoping (er, expecting!) you can write a program that recovers the photos for us!</p>

<p>Even though JPEGs are more complicated than BMPs, JPEGs have ‚Äúsignatures,‚Äù patterns of bytes that can distinguish them from other file formats. Specifically, the first three bytes of JPEGs are</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0xff 0xd8 0xff
</code></pre></div></div>

<p>from first byte to third byte, left to right. The fourth byte, meanwhile, is either <code class="language-plaintext highlighter-rouge">0xe0</code>, <code class="language-plaintext highlighter-rouge">0xe1</code>, <code class="language-plaintext highlighter-rouge">0xe2</code>, <code class="language-plaintext highlighter-rouge">0xe3</code>, <code class="language-plaintext highlighter-rouge">0xe4</code>, <code class="language-plaintext highlighter-rouge">0xe5</code>, <code class="language-plaintext highlighter-rouge">0xe6</code>, <code class="language-plaintext highlighter-rouge">0xe7</code>, <code class="language-plaintext highlighter-rouge">0xe8</code>, <code class="language-plaintext highlighter-rouge">0xe9</code>, <code class="language-plaintext highlighter-rouge">0xea</code>, <code class="language-plaintext highlighter-rouge">0xeb</code>, <code class="language-plaintext highlighter-rouge">0xec</code>, <code class="language-plaintext highlighter-rouge">0xed</code>, <code class="language-plaintext highlighter-rouge">0xee</code>, or <code class="language-plaintext highlighter-rouge">0xef</code>. Put another way, the fourth byte‚Äôs first four bits are <code class="language-plaintext highlighter-rouge">1110</code>.</p>

<p>Odds are, if you find this pattern of four bytes on media known to store photos (e.g., my memory card), they demarcate the start of a JPEG. To be fair, you might encounter these patterns on some disk purely by chance, so data recovery isn‚Äôt an exact science.</p>

<p>Fortunately, digital cameras tend to store photographs contiguously on memory cards, whereby each photo is stored immediately after the previously taken photo. Accordingly, the start of a JPEG usually demarks the end of another. However, digital cameras often initialize cards with a FAT file system whose ‚Äúblock size‚Äù is 512 bytes (B). The implication is that these cameras only write to those cards in units of 512 B. A photo that‚Äôs 1 MB (i.e., 1,048,576 B) thus takes up 1048576 √∑ 512 = 2048 ‚Äúblocks‚Äù on a memory card. But so does a photo that‚Äôs, say, one byte smaller (i.e., 1,048,575 B)! The wasted space on disk is called ‚Äúslack space.‚Äù Forensic investigators often look at slack space for remnants of suspicious data.</p>

<p>The implication of all these details is that you, the investigator, can probably write a program that iterates over a copy of my memory card, looking for JPEGs‚Äô signatures. Each time you find a signature, you can open a new file for writing and start filling that file with bytes from my memory card, closing that file only once you encounter another signature. Moreover, rather than read my memory card‚Äôs bytes one at a time, you can read 512 of them at a time into a buffer for efficiency‚Äôs sake. Thanks to FAT, you can trust that JPEGs‚Äô signatures will be ‚Äúblock-aligned.‚Äù That is, you need only look for those signatures in a block‚Äôs first four bytes.</p>

<p>Realize, of course, that JPEGs can span contiguous blocks. Otherwise, no JPEG could be larger than 512 B. But the last byte of a JPEG might not fall at the very end of a block. Recall the possibility of slack space. But not to worry. Because this memory card was brand-new when I started snapping photos, odds are it‚Äôd been ‚Äúzeroed‚Äù (i.e., filled with 0s) by the manufacturer, in which case any slack space will be filled with 0s. It‚Äôs okay if those trailing 0s end up in the JPEGs you recover; they should still be viewable.</p>

<p>Now, I only have one memory card, but there are a lot of you! And so I‚Äôve gone ahead and created a ‚Äúforensic image‚Äù of the card, storing its contents, byte after byte, in a file called <code class="language-plaintext highlighter-rouge">card.raw</code>. So that you don‚Äôt waste time iterating over millions of 0s unnecessarily, I‚Äôve only imaged the first few megabytes of the memory card. But you should ultimately find that the image contains 50 JPEGs.</p>

<h2 id="getting-started">Getting Started</h2>

<p>Here‚Äôs how to download this problem‚Äôs ‚Äúdistribution code‚Äù (i.e., starter code) into your own CS50 IDE. Log into <a href="https://cs50.io/">CS50 IDE</a> and then, in a terminal window, execute each of the below.</p>

<ol>
  <li>Navigate to your <code class="language-plaintext highlighter-rouge">pset4</code> directory that should already exist.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">wget http://cdn.cs50.net/2020/fall/psets/4/recover/recover.zip</code> to download a (compressed) ZIP file with this problem‚Äôs distribution.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">unzip recover.zip</code> to uncompress that file.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">rm recover.zip</code> followed by <code class="language-plaintext highlighter-rouge">yes</code> or <code class="language-plaintext highlighter-rouge">y</code> to delete that ZIP file.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">ls</code>. You should see a directory called <code class="language-plaintext highlighter-rouge">recover</code>, which was inside of that ZIP file.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">cd recover</code> to change into that directory.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">ls</code>. You should see this problem‚Äôs distribution, including <code class="language-plaintext highlighter-rouge">card.raw</code> and <code class="language-plaintext highlighter-rouge">recover.c</code>.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>Implement a program called <code class="language-plaintext highlighter-rouge">recover</code> that recovers JPEGs from a forensic image.</p>

<ul>
  <li data-marker="*">Implement your program in a file called <code class="language-plaintext highlighter-rouge">recover.c</code> in a directory called <code class="language-plaintext highlighter-rouge">recover</code>.</li>
  <li data-marker="*">Your program should accept exactly one command-line argument, the name of a forensic image from which to recover JPEGs.</li>
  <li data-marker="*">If your program is not executed with exactly one command-line argument, it should remind the user of correct usage, and <code class="language-plaintext highlighter-rouge">main</code> should return <code class="language-plaintext highlighter-rouge">1</code>.</li>
  <li data-marker="*">If the forensic image cannot be opened for reading, your program should inform the user as much, and <code class="language-plaintext highlighter-rouge">main</code> should return <code class="language-plaintext highlighter-rouge">1</code>.</li>
  <li data-marker="*">The files you generate should each be named <code class="language-plaintext highlighter-rouge">###.jpg</code>, where <code class="language-plaintext highlighter-rouge">###</code> is a three-digit decimal number, starting with <code class="language-plaintext highlighter-rouge">000</code> for the first image and counting up.</li>
  <li data-marker="*">Your program, if it uses <code class="language-plaintext highlighter-rouge">malloc</code>, must not leak any memory.</li>
</ul>

<h2 id="walkthrough">Walkthrough</h2>

<div class="border embed-responsive embed-responsive-16by9" data-video=""><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" class="embed-responsive-item" src="https://www.youtube.com/embed/ooL0r_8N9ms?modestbranding=0&amp;rel=0&amp;showinfo=0"></iframe></div>

<h2 id="usage">Usage</h2>

<p>Your program should behave per the examples below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recover
Usage: ./recover image
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./recover card.raw
</code></pre></div></div>

<h2 id="hints">Hints</h2>

<p>Keep in mind that you can open <code class="language-plaintext highlighter-rouge">card.raw</code> programmatically with <code class="language-plaintext highlighter-rouge">fopen</code>, as with the below, provided <code class="language-plaintext highlighter-rouge">argv[1]</code> exists.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
</code></pre></div></div>
<p>When executed, your program should recover every one of the JPEGs from <code class="language-plaintext highlighter-rouge">card.raw</code>, storing each as a separate file in your current working directory. Your program should number the files it outputs by naming each <code class="language-plaintext highlighter-rouge">###.jpg</code>, where <code class="language-plaintext highlighter-rouge">###</code> is three-digit decimal number from <code class="language-plaintext highlighter-rouge">000</code> on up. (Befriend <a href="https://man.cs50.io/3/sprintf"><code class="language-plaintext highlighter-rouge">sprintf</code></a>.) You need not try to recover the JPEGs‚Äô original names. To check whether the JPEGs your program spit out are correct, simply double-click and take a look! If each photo appears intact, your operation was likely a success!</p>

<p>Odds are, though, the JPEGs that the first draft of your code spits out won‚Äôt be correct. (If you open them up and don‚Äôt see anything, they‚Äôre probably not correct!) Execute the command below to delete all JPEGs in your current working directory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rm *.jpg
</code></pre></div></div>

<p>If you‚Äôd rather not be prompted to confirm each deletion, execute the command below instead.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rm -f *.jpg
</code></pre></div></div>

<p>Just be careful with that <code class="language-plaintext highlighter-rouge">-f</code> switch, as it ‚Äúforces‚Äù deletion without prompting you.</p>

<p>If you‚Äôd like to create a new type to store a byte of data, you can do so via the below, which defines a new type called <code class="language-plaintext highlighter-rouge">BYTE</code> to be a <code class="language-plaintext highlighter-rouge">uint8_t</code> (a type defined in <code class="language-plaintext highlighter-rouge">stdint.h</code>, representing an 8-bit unsigned integer).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typedef uint8_t BYTE;
</code></pre></div></div>

<p>Keep in mind, too, that you can read data from a file using <a href="https://man.cs50.io/3/fread"><code class="language-plaintext highlighter-rouge">fread</code></a>, which will read data from a file into a location in memory and return the number of items successfully read from the file.</p>

<h2 id="testing">Testing</h2>

<p>Execute the below to evaluate the correctness of your code using <code class="language-plaintext highlighter-rouge">check50</code>. But be sure to compile and test it yourself as well!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>check50 cs50/problems/2021/x/recover
</code></pre></div></div>

<p>Execute the below to evaluate the style of your code using <code class="language-plaintext highlighter-rouge">style50</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>style50 recover.c
</code></pre></div></div>

<h2 id="how-to-submit">How to Submit</h2>

<p>Execute the below, logging in with your GitHub username and password when prompted. For security, you‚Äôll see asterisks (<code class="language-plaintext highlighter-rouge">*</code>) instead of the actual characters in your password.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>submit50 cs50/problems/2021/x/recover
</code></pre></div></div>


                </main>

            </div>

        </div>

        
 
    


</body></html>