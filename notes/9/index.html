<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property="og:description" content="Harvard Universty's introduction to the intellectual enterprises of computer science and the art of programming.">

<meta property="og:image" content="https://img.youtube.com/vi/zYierUhIFNQ/maxresdefault.jpg"><meta property="og:title" content="Lecture 9 - CS50x 2021"><link href="../../favicon.ico%3F1610389211" rel="icon">

<!-- https://fonts.google.com/specimen/PT+Sans?query=PT+Sans&selection.family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700 -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>

<!-- http://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
<script src="../../assets/jquery/dist/jquery.min.js%3F1610389211"></script>
<script src="../../assets/bootstrap/dist/js/bootstrap.bundle.min.js%3F1610389211"></script>

<!-- https://bootstrap-table.com/docs/getting-started/introduction/ -->
<link href="../../assets/bootstrap-table/dist/bootstrap-table.min.css%3F1610389211.css" rel="stylesheet">
<script src="../../assets/bootstrap-table/dist/bootstrap-table.min.js%3F1610389211"></script>
<script src="../../assets/bootstrap-table/dist/extensions/mobile/bootstrap-table-mobile.min.js%3F1610389211"></script>

<!-- https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use -->
<link href="../../assets/@fortawesome/fontawesome-free/css/all.min.css%3F1610389211.css" rel="stylesheet">

<!-- https://moment.github.io/luxon/ -->
<script src="../../assets/luxon.min.js%3F1610389211"></script>

<!-- http://docs.mathjax.org/ -->
<!-- https://www.jsdelivr.com/package/npm/mathjax?path=es5 -->
<script crossorigin="anonymous" integrity="sha256-+nfSJ1LiSvANSK3wvi6FjM+oFwoIQvURU1frozp5z6o=" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-chtml.js"></script>

<!-- https://github.com/verlok/vanilla-lazyload -->
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.7.0/intersection-observer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.3.0/dist/lazyload.min.js"></script>



<link href="../../assets/page.css%3F1610389211.css" rel="stylesheet">
<script src="../../assets/jekyll-theme-cs50.js%3F1610389211"></script>

<script>
    window.CS50 = {
        locale: "en",
        tz: "America/New_York"
    };
</script>

<title>Lecture 9 - CS50x 2021</title>
</head>

    <body class="invisible">

        
        
        
        <div class="alert alert-dismissible fixed-top mb-0 rounded-0 shadow" data-alert="success" id="alert" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">√ó</span>
            </button><p>This is CS50x 2021, the newest version of the course. Looking for <a href="https://cs50.harvard.edu/x/2020/">CS50x 2020</a>?</p></div>
        
        

        <div class="container-fluid">

            <div class="row">

                <aside class="col-md">
 
                    <header><h1 data-id="this-is-cs50x"><a href="../../index.html">This is CS50x</a></h1>

<p>OpenCourseWare</p>

<p><a href="https://community.alumni.harvard.edu/give/59206872" class="pr-1 small">Donate</a>
<a href="https://community.alumni.harvard.edu/give/59206872" class="small"><i aria-hidden="true" class="fas fa-external-link-alt"></i></a></p>

<p><a href="https://cs.harvard.edu/malan/">David J. Malan</a><br>
<a href="mailto:malan@harvard.edu">malan@harvard.edu</a><br>
<a href="https://www.facebook.com/dmalan" class="mr-2"><i class="fab fa-facebook-f"></i></a><a href="https://github.com/dmalan" class="mr-2"><i class="fab fa-github"></i></a><a href="https://www.instagram.com/davidjmalan/" class="mr-2"><i class="fab fa-instagram"></i></a><a href="https://www.linkedin.com/in/malan/" class="mr-2"><i class="fab fa-linkedin"></i></a><a href="https://www.quora.com/profile/David-J-Malan" class="mr-2"><i class="fab fa-quora"></i></a><a href="https://www.reddit.com/user/davidjmalan" class="mr-2"><i class="fab fa-reddit-alien"></i></a><a href="https://twitter.com/davidjmalan" class="mr-2"><i class="fab fa-twitter"></i></a></p></header>

                    

                    <button aria-controls="nav" aria-expanded="false" class="btn btn-sm collapsed d-md-none" data-target="aside > nav" data-toggle="collapse">
                        Menu
                    </button>

                    <nav class="collapse d-md-block" id="nav"><hr>

<ul>
  <li data-marker="*"><a href="../../seminars/index.html">CS50‚Äôs New Year‚Äôs Seminars</a> <span class="text-white">ü•Ç</span></li>
  <li data-marker="*"><a href="../../gallery/index.html">Gallery of Final Projects</a> <span class="pl-1 text-white">üñºÔ∏è </span></li>
  <li data-marker="*"><a href="../../new/index.html">What‚Äôs new for 2021?</a></li>
</ul>
<ul>
  <li data-marker="*"><a href="../../weeks/0/index.html">Week 0</a> Scratch</li>
  <li data-marker="*"><a href="../../weeks/1/index.html">Week 1</a> C</li>
  <li data-marker="*"><a href="../../weeks/2/index.html">Week 2</a> Arrays</li>
  <li data-marker="*"><a href="../../weeks/3/index.html">Week 3</a> Algorithms</li>
  <li data-marker="*"><a href="../../weeks/4/index.html">Week 4</a> Memory</li>
  <li data-marker="*"><a href="../../weeks/5/index.html">Week 5</a> Data Structures</li>
  <li data-marker="*"><a href="../../weeks/6/index.html">Week 6</a> Python</li>
  <li data-marker="*"><a href="../../weeks/7/index.html">Week 7</a> SQL</li>
  <li data-marker="*"><a href="../../weeks/8/index.html">Week 8</a> HTML, CSS, JavaScript</li>
  <li data-marker="*"><a href="../../weeks/9/index.html">Week 9</a> Flask</li>
  <li data-marker="*"><a href="../../weeks/10/index.html">Week 10</a> Ethics</li>
</ul>
<ul>
  <li data-marker="*" class="small"><a href="../../weeks/security/index.html">Security</a></li>
  <li data-marker="*" class="small"><a href="../../weeks/ai/index.html">Artificial Intelligence</a></li>
</ul>
<ul>
  <li data-marker="*"><a href="../../project/index.html">Final Project</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../honesty/index.html">Academic Honesty</a></li>
  <li data-marker="*"><a href="../../certificate/index.html">CS50 Certificate</a></li>
  <li data-marker="*"><a href="../../faqs/index.html">FAQs</a></li>
  <li data-marker="*"><a href="https://cs50.me/cs50x">Gradebook</a></li>
  <li data-marker="*"><a href="../../staff/index.html">Staff</a></li>
  <li data-marker="*"><a href="../../syllabus/index.html">Syllabus</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="https://cs50.harvard.edu/x/ed">Ed Discussion</a> for Q&amp;A</li>
  <li data-marker="*" class="small"><a href="https://us.edstem.org/quickstart/ed-discussion.pdf">Quick Start Guide</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://cs50.edx.org/">edX</a></li>
  <li data-marker="*"><a href="https://www.youtube.com/playlist?list=PLhQjrBD2T382_R182iC2gNZI9HzWFMC_8">YouTube</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://ide.cs50.io/">CS50 IDE</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/css/">CSS Tutorial</a></li>
  <li data-marker="*"><a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/">Flask Quickstart</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/html/">HTML Tutorial</a></li>
  <li data-marker="*"><a href="https://jinja.palletsprojects.com/en/2.11.x/templates/">Jinja Template Designer Documentation</a></li>
  <li data-marker="*"><a href="https://man.cs50.io/">Manual Pages</a></li>
  <li data-marker="*"><a href="https://docs.python.org/3.7/search.html">Python Documentation</a></li>
  <li data-marker="*"><a href="https://scratch.mit.edu/">Scratch</a></li>
  <li data-marker="*"><a href="https://www.w3schools.com/sql/">SQL Tutorial</a></li>
  <li data-marker="*"><a href="https://cs50.readthedocs.io/style/c/">Style Guide</a></li>
</ul>

<hr>

<ul class="small">
  <li data-marker="*"><a href="https://cs50.noticeable.io/">Changelog</a></li>
  <li data-marker="*"><a href="https://cs50.statuspage.io/">Status Page</a></li>
</ul>

<hr>

<ul>
  <li data-marker="*"><a href="../../communities/index.html">Communities</a></li>
  <li data-marker="*" class="small"><a href="https://discord.gg/cs50">Discord</a></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/groups/cs50/">Facebook Group</a></li>
  <li data-marker="*" class="small"><a href="https://www.facebook.com/cs50/">Facebook Page</a></li>
  <li data-marker="*" class="small"><a href="https://github.com/cs50">GitHub</a></li>
  <li data-marker="*" class="small"><a href="https://gitter.im/cs50/x">Gitter</a></li>
  <li data-marker="*" class="small"><a href="https://instagram.com/cs50">Instagram</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/groups/7437240/">LinkedIn Group</a></li>
  <li data-marker="*" class="small"><a href="https://www.linkedin.com/school/CS50/">LinkedIn Page</a></li>
  <li data-marker="*" class="small"><a href="https://www.quora.com/topic/CS50">Quora</a></li>
  <li data-marker="*" class="small"><a href="https://www.reddit.com/r/cs50/">Reddit</a></li>
  <li data-marker="*" class="small"><a href="https://cs50.edx.org/slack">Slack</a></li>
  <li data-marker="*" class="small"><a href="https://www.snapchat.com/add/cs50">Snapchat</a></li>
  <li data-marker="*" class="small"><a href="https://soundcloud.com/cs50">SoundCloud</a></li>
  <li data-marker="*" class="small"><a href="https://twitter.com/cs50">Twitter</a></li>
  <li data-marker="*" class="small"><a href="http://www.youtube.com/subscription_center?add_user=cs50tv">YouTube</a></li>
</ul>

<hr>

<p><a href="https://cs50.harvardshop.com/"><img src="https://i.imgur.com/GGMdcKt.png" alt="Harvard Shop"></a></p>

<hr>

<p><a href="../../license/index.html" class="small"><i class="fab fa-creative-commons mr-1"></i>License</a></p></nav>

                    <footer></footer>

                </aside>

                <main class="col-md">

                    <h1 class="no_toc" id="lecture-9">Lecture 9</h1>

<ul id="markdown-toc">
  <li><a href="index.html#web-programming" id="markdown-toc-web-programming">Web programming</a></li>
  <li><a href="index.html#flask" id="markdown-toc-flask">Flask</a></li>
  <li><a href="index.html#forms" id="markdown-toc-forms">Forms</a></li>
  <li><a href="index.html#post" id="markdown-toc-post">POST</a></li>
  <li><a href="index.html#layouts" id="markdown-toc-layouts">Layouts</a></li>
  <li><a href="index.html#frosh-ims" id="markdown-toc-frosh-ims">Frosh IMs</a></li>
  <li><a href="index.html#storing-data" id="markdown-toc-storing-data">Storing data</a></li>
  <li><a href="index.html#sessions" id="markdown-toc-sessions">Sessions</a></li>
  <li><a href="index.html#store-shows" id="markdown-toc-store-shows">store, shows</a></li>
</ul>

<h2 id="web-programming">Web programming</h2>

<ul>
  <li data-marker="*">Today we‚Äôll create more advanced web applications by writing code that runs on the server.</li>
  <li data-marker="*">Last week, we used <code class="language-plaintext highlighter-rouge">http-server</code> in the CS50 IDE as a <strong>web server</strong>, a program that listens for connections and requests, and responds with web pages or other resources.</li>
  <li data-marker="*">An HTTP request has headers, like:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/1.1
...
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">These headers can ask for some file or page, or send data from the browser back to the server.</li>
    </ul>
  </li>
  <li data-marker="*">While <code class="language-plaintext highlighter-rouge">http-server</code> only responds with static pages, we can use other web servers that parses, or analyzes request headers, like <code class="language-plaintext highlighter-rouge">GET /search?q=cats HTTP/1.1</code>, to return pages dynamically.</li>
</ul>

<h2 id="flask">Flask</h2>

<ul>
  <li data-marker="*">We‚Äôll use Python and a library called <strong>Flask</strong> to write our own web server, implementing additional features. Flask is also a <strong>framework</strong>, where the library of code also comes with a set of conventions for how it should be used. For example, like other libraries, Flask includes functions we can use to parse requests individually, but as a framework, also requires our program‚Äôs code to be organized in a certain way:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>application.py
requirements.txt
static/
templates/
</code></pre></div>    </div>
    <ul>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">application.py</code> will have the Python code for our web server.</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">requirements.py</code> includes a list of required libraries for our application.</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">static/</code> is a directory of static files, like CSS and JavaScript files.</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">templates/</code> is a directory for files that will be used to create our final HTML.</li>
    </ul>
  </li>
  <li data-marker="*">There are many web server frameworks for each of the popular languages, and Flask will be a representative one that we use today.</li>
  <li data-marker="*">Flask also implements a particular <strong>design pattern</strong>, or way that our program and code is organized. For Flask, the design pattern is generally <strong>MVC</strong>, or Model‚Äìview‚Äìcontroller:<br>
<img src="mvc.png" alt="Model with arrow to View labeled Updates; View with arrow to User labeled Sees; User with arrow to Controlled labeled Uses; Controller with arrow to Model labeled Manipulates">
    <ul>
      <li data-marker="*">The controller is our logic and code that manages our application overall, given user input. In Flask, this will be our Python code.</li>
      <li data-marker="*">The view is the user interface, like the HTML and CSS that the user will see and interact with.</li>
      <li data-marker="*">The model is our application‚Äôs data, such as a SQL database or CSV file.</li>
    </ul>
  </li>
  <li data-marker="*">The simplest Flask application might look like this:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"hello, world"</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">First, we‚Äôll import <code class="language-plaintext highlighter-rouge">Flask</code> from the <code class="language-plaintext highlighter-rouge">flask</code> library, which happens to use a capital letter for its main name.</li>
      <li data-marker="*">Then, we‚Äôll create an <code class="language-plaintext highlighter-rouge">app</code> variable by giving our file‚Äôs name to the <code class="language-plaintext highlighter-rouge">Flask</code> variable.</li>
      <li data-marker="*">Next, we‚Äôll label a function for the <code class="language-plaintext highlighter-rouge">/</code> route, or URL with <code class="language-plaintext highlighter-rouge">@app.route</code>. The <code class="language-plaintext highlighter-rouge">@</code> symbol in Python is called a decorator, which applies one function to another.</li>
      <li data-marker="*">We‚Äôll call the function <code class="language-plaintext highlighter-rouge">index</code>, since it should respond to a request for <code class="language-plaintext highlighter-rouge">/</code>, the default page. And our function will just respond with a string for now.</li>
    </ul>
  </li>
  <li data-marker="*">In the CS50 IDE, we can go to the directory with our application code, and type <code class="language-plaintext highlighter-rouge">flask run</code> to start it. We‚Äôll see a URL, and we can open it to see <code class="language-plaintext highlighter-rouge">hello, world</code>.</li>
  <li data-marker="*">We‚Äôll update our code to actually return HTML with the <code class="language-plaintext highlighter-rouge">render_template</code> function, which finds a file given and returns its contents:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll need to create a <code class="language-plaintext highlighter-rouge">templates/</code> directory, and create an <code class="language-plaintext highlighter-rouge">index.html</code> file with some content inside it.</li>
      <li data-marker="*">Now, typing <code class="language-plaintext highlighter-rouge">flask run</code> will return that HTML file when we visit our server‚Äôs URL.</li>
    </ul>
  </li>
  <li data-marker="*">We‚Äôll pass in an argument to <code class="language-plaintext highlighter-rouge">render_template</code> in our controller code:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">))</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">It turns out that we can give <code class="language-plaintext highlighter-rouge">render_template</code> any named argument, like <code class="language-plaintext highlighter-rouge">name</code>, and it will substitute that in our template, or our HTML file with placeholders.
        <ul>
          <li data-marker="*">In <code class="language-plaintext highlighter-rouge">index.html</code>, we‚Äôll replace <code class="language-plaintext highlighter-rouge">hello, world</code> with <code class="language-plaintext highlighter-rouge">hello, </code> to tell Flask where to substitute the <code class="language-plaintext highlighter-rouge">name</code> variable:
            <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        hello, {{ name }}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li data-marker="*">We can use the <code class="language-plaintext highlighter-rouge">request</code> variable from the Flask library to get a parameter from the HTTP request, in this case also <code class="language-plaintext highlighter-rouge">name</code>, and fall back to a default of <code class="language-plaintext highlighter-rouge">world</code> if one wasn‚Äôt provided.</li>
      <li data-marker="*">Now, when we restart our server after making these changes, and visit the default page with a URL like <code class="language-plaintext highlighter-rouge">/?name=David</code>, we‚Äôll see that same input returned back to us in the HTML generated by our server.</li>
    </ul>
  </li>
  <li data-marker="*">We can presume that Google‚Äôs search query, at <code class="language-plaintext highlighter-rouge">/search?q=cats</code>, is also parsed by some code for the <code class="language-plaintext highlighter-rouge">q</code> parameter and passed along to some database to get all the results that are relevant. Those results are then used to generate the final HTML page.</li>
</ul>

<h2 id="forms">Forms</h2>

<ul>
  <li data-marker="*">We‚Äôll move our original template into <code class="language-plaintext highlighter-rouge">greet.html</code>, so it will greet the user with their name. In <code class="language-plaintext highlighter-rouge">index.html</code>, we‚Äôll create a form:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/greet"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll send the form to the <code class="language-plaintext highlighter-rouge">/greet</code> route, and have an input for the <code class="language-plaintext highlighter-rouge">name</code> parameter and one for the submit button.</li>
      <li data-marker="*">In our <code class="language-plaintext highlighter-rouge">applications.py</code> controller, we‚Äôll also need to add a function for the <code class="language-plaintext highlighter-rouge">/greet</code> route, which is almost exactly what we had for <code class="language-plaintext highlighter-rouge">/</code> before:
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/greet"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"greet.html"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">))</span>
</code></pre></div>        </div>
        <ul>
          <li data-marker="*">Our form at <code class="language-plaintext highlighter-rouge">index.html</code> will be static since it can be the same every time.</li>
        </ul>
      </li>
      <li data-marker="*">Now, we can run our server, see our form at the default page, and use it to generate another page.</li>
    </ul>
  </li>
</ul>

<h2 id="post">POST</h2>

<ul>
  <li data-marker="*">Our form above used the GET method, which includes our form‚Äôs data in the URL.</li>
  <li data-marker="*">We‚Äôll change the method in our HTML: <code class="language-plaintext highlighter-rouge">&lt;form action="/greet" method="form"&gt;</code>. Our controller will also need to be changed to accept the POST method, and look for the parameter somewhere else:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/greet"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"greet.html"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">))</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">While <code class="language-plaintext highlighter-rouge">request.args</code> is for parameters in a GET request, we have to use <code class="language-plaintext highlighter-rouge">request.form</code> in Flask for parameters in a POST request.</li>
    </ul>
  </li>
  <li data-marker="*">Now, when we restart our application after making these changes, we can see that the form takes us to <code class="language-plaintext highlighter-rouge">/greet</code>, but the contents aren‚Äôt included in the URL anymore.</li>
</ul>

<h2 id="layouts">Layouts</h2>

<ul>
  <li data-marker="*">In <code class="language-plaintext highlighter-rouge">index.html</code> and <code class="language-plaintext highlighter-rouge">greet.html</code>, we have some repeated HTML code. With just HTML, we aren‚Äôt able to share code between files, but with Flask templates (and other web frameworks), we can factor out such common content.</li>
  <li data-marker="*">We‚Äôll create another template, <code class="language-plaintext highlighter-rouge">layout.html</code>:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>hello<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">Flask supports Jinja, a templating language, which uses the <code class="language-plaintext highlighter-rouge">{% %}</code> syntax to include placeholder blocks, or other chunks of code. Here we‚Äôve named our block <code class="language-plaintext highlighter-rouge">body</code> since it contains the HTML that should go in the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> element.</li>
    </ul>
  </li>
  <li data-marker="*">In <code class="language-plaintext highlighter-rouge">index.html</code>, we‚Äôll use the <code class="language-plaintext highlighter-rouge">layout.html</code> blueprint and only define the <code class="language-plaintext highlighter-rouge">body</code> block with:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/greet"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>

{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Similarly, in <code class="language-plaintext highlighter-rouge">greet.html</code>, we define the <code class="language-plaintext highlighter-rouge">body</code> block with just the greeting:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    hello, {{ name }}

{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Now, if we restart our server, and view the source of our HTML after opening our server‚Äôs URL, we see a complete page with our form inside our HTML file, generated by Flask.</li>
  <li data-marker="*">We can even reuse the same route to support both GET and POST methods:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span> <span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"greet.html"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">First, we check if the <code class="language-plaintext highlighter-rouge">method</code> of the <code class="language-plaintext highlighter-rouge">request</code> is a POST request. If so, we‚Äôll look for the <code class="language-plaintext highlighter-rouge">name</code> parameter and return HTML from the <code class="language-plaintext highlighter-rouge">greet.html</code> template. Otherwise, we‚Äôll return HTML from the <code class="language-plaintext highlighter-rouge">index.html</code>, which has our form.</li>
      <li data-marker="*">We‚Äôll also need to change the form‚Äôs <code class="language-plaintext highlighter-rouge">action</code> to the default <code class="language-plaintext highlighter-rouge">/</code> route.</li>
    </ul>
  </li>
</ul>

<h2 id="frosh-ims">Frosh IMs</h2>

<ul>
  <li data-marker="*">One of David‚Äôs first web applications was for students on campus to register for ‚Äúfrosh IMs‚Äù, intramural sports.</li>
  <li data-marker="*">We‚Äôll use a <code class="language-plaintext highlighter-rouge">layout.html</code> similar to what we had before:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>froshims<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        {% block body %}{% endblock %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">A <code class="language-plaintext highlighter-rouge">&lt;meta&gt;</code> tag in <code class="language-plaintext highlighter-rouge">&lt;head&gt;</code> allows us to add more metadata to our page. In this case, we‚Äôre adding a <code class="language-plaintext highlighter-rouge">content</code> attribute for the <code class="language-plaintext highlighter-rouge">viewport</code> metadata, in order to tell the browser to automamtically scale our page‚Äôs size and fonts to the device.</li>
    </ul>
  </li>
  <li data-marker="*">In our <code class="language-plaintext highlighter-rouge">application.py</code>, we‚Äôll return our <code class="language-plaintext highlighter-rouge">index.html</code> template for the default <code class="language-plaintext highlighter-rouge">/</code> route:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">SPORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Dodgeball"</span><span class="p">,</span>
    <span class="s">"Flag Football"</span><span class="p">,</span>
    <span class="s">"Soccer"</span><span class="p">,</span>
    <span class="s">"Volleyball"</span><span class="p">,</span>
    <span class="s">"Ultimate Frisbee"</span>
<span class="p">]</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Our <code class="language-plaintext highlighter-rouge">index.html</code> template will look like this:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/register"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"sport"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">disabled</span> <span class="na">selected</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>Sport<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Dodgeball"</span><span class="nt">&gt;</span>Dodgeball<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Flag Football"</span><span class="nt">&gt;</span>Flag Football<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Soccer"</span><span class="nt">&gt;</span>Soccer<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Volleyball"</span><span class="nt">&gt;</span>Volleyball<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Ultimate Frisbee"</span><span class="nt">&gt;</span>Ultimate Frisbee<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Register"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/form&gt;</span>
{% endblock %}
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll have a form like before, and have a <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> menu with options for each sport.</li>
    </ul>
  </li>
  <li data-marker="*">In our <code class="language-plaintext highlighter-rouge">application.py</code>, we‚Äôll allow POST for our <code class="language-plaintext highlighter-rouge">/register</code> route:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/register"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"sport"</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"failure.html"</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"success.html"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll check that our form‚Äôs values are valid, and then return a template depending on the results, even though we aren‚Äôt actually doing anything with the data yet.</li>
    </ul>
  </li>
  <li data-marker="*">But a user can change the form‚Äôs HTML in their browser, and send a request that contains some other sport as the selected option!</li>
  <li data-marker="*">We‚Äôll check that the value for <code class="language-plaintext highlighter-rouge">sport</code> is valid by creating a list in <code class="language-plaintext highlighter-rouge">application.py</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">SPORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Dodgeball"</span><span class="p">,</span>
    <span class="s">"Flag Football"</span><span class="p">,</span>
    <span class="s">"Soccer"</span><span class="p">,</span>
    <span class="s">"Volleyball"</span><span class="p">,</span>
    <span class="s">"Ultimate Frisbee"</span>
<span class="p">]</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">,</span> <span class="n">sports</span><span class="o">=</span><span class="n">SPORTS</span><span class="p">)</span>

<span class="p">...</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">Then, we‚Äôll pass that list into the <code class="language-plaintext highlighter-rouge">index.html</code> template.</li>
    </ul>
  </li>
  <li data-marker="*">In our template, we can even use loops to generate a list of options from the list of strings passed in as <code class="language-plaintext highlighter-rouge">sports</code>:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"sport"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">disabled</span> <span class="na">selected</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>Sport<span class="nt">&lt;/option&gt;</span>
    {% for sport in sports %}
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"{{ sport }}"</span><span class="nt">&gt;</span>{{ sport }}<span class="nt">&lt;/option&gt;</span>
    {% endfor %}
<span class="nt">&lt;/select&gt;</span>
...
</code></pre></div>    </div>
  </li>
  <li data-marker="*">Finally, we can check that the <code class="language-plaintext highlighter-rouge">sport</code> sent in the POST request is in the list <code class="language-plaintext highlighter-rouge">SPORTS</code> in <code class="language-plaintext highlighter-rouge">application.py</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/register"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"sport"</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"failure.html"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"success.html"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">We can change the select menu in our form to be checkboxes, to allow for multiple sports:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Register<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/register"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        {% for sport in sports %}
            <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"sport"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"{{ sport }}"</span><span class="nt">&gt;</span> {{ sport }}
        {% endfor %}
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Register"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/form&gt;</span>
{% endblock %}
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">In our <code class="language-plaintext highlighter-rouge">register</code> function, we can call <code class="language-plaintext highlighter-rouge">request.form.getlist</code> to get the list of checked options.</li>
    </ul>
  </li>
  <li data-marker="*">We can also use radio buttons, which will allow only one option to be chosen at a time.</li>
</ul>

<h2 id="storing-data">Storing data</h2>

<ul>
  <li data-marker="*">Let‚Äôs store our registered students, or registrants, in a dictionary in the memory of our web server:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">REGISTRANTS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="p">...</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/register"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing name"</span><span class="p">)</span>

    <span class="n">sport</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sport</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sport</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Invalid sport"</span><span class="p">)</span>

    <span class="n">REGISTRANTS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sport</span>

    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/registrants"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll create a dictionary called <code class="language-plaintext highlighter-rouge">REGISTRANTS</code>, and in <code class="language-plaintext highlighter-rouge">register</code> we‚Äôll first check the <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">sport</code>, returning a different error message in each case. Then, we can safely store the name and sport in our <code class="language-plaintext highlighter-rouge">REGISTRANTS</code> dictionary, and redirect to another route that will display registered students.</li>
      <li data-marker="*">The error message template, meanwhile, will just display the message:
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    {{ message }}
{% endblock %}
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li data-marker="*">Let‚Äôs add the <code class="language-plaintext highlighter-rouge">/registrants</code> route and template to show the registered students:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/registrants"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">registrants</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"registrants.html"</span><span class="p">,</span> <span class="n">registrants</span><span class="o">=</span><span class="n">REGISTRANTS</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">In our route, we‚Äôll pass in the <code class="language-plaintext highlighter-rouge">REGISTRANTS</code> dictionary to the template as a parameter called <code class="language-plaintext highlighter-rouge">registrants</code>:
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}
    <span class="nt">&lt;h1&gt;</span>Registrants<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;table&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>Sport<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            {% for name in registrants %}
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ name }}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>{{ registrants[name] }}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            {% endfor %}
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
{% endblock %}
</code></pre></div>        </div>
      </li>
      <li data-marker="*">Our template will have a table, with a heading row and row for each key and value stored in <code class="language-plaintext highlighter-rouge">registrants</code>.</li>
    </ul>
  </li>
  <li data-marker="*">If our web server stops running, we‚Äôll lose the data stored, so we‚Äôll use a SQLite database with the SQL library from <code class="language-plaintext highlighter-rouge">cs50</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="s">"sqlite:///froshims.db"</span><span class="p">)</span>

<span class="p">...</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">In the IDE‚Äôs terminal, we can run <code class="language-plaintext highlighter-rouge">sqlite3 froshims.db</code> to open the database, and use the <code class="language-plaintext highlighter-rouge">.schema</code> command to see the table with columns of <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">name</code>, and <code class="language-plaintext highlighter-rouge">sport</code>, which was created in advance.</li>
    </ul>
  </li>
  <li data-marker="*">Now, in our routes, we can insert and select rows with SQL:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/register"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing name"</span><span class="p">)</span>
    <span class="n">sport</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sport</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sport</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Invalid sport"</span><span class="p">)</span>

    <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO registrants (name, sport) VALUES(?, ?)"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sport</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/registrants"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/registrants"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">registrants</span><span class="p">():</span>
    <span class="n">registrants</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM registrants"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"registrants.html"</span><span class="p">,</span> <span class="n">registrants</span><span class="o">=</span><span class="n">registrants</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">Once we‚Äôve validated the request, we can use <code class="language-plaintext highlighter-rouge">INSERT INTO</code> to add a row, and similarly, in <code class="language-plaintext highlighter-rouge">registrants()</code>, we can <code class="language-plaintext highlighter-rouge">SELECT</code> all rows and pass them to the template as a list of rows.</li>
    </ul>
  </li>
  <li data-marker="*">Our <code class="language-plaintext highlighter-rouge">registrants.html</code> template will also need to be adjusted, since each row returned from <code class="language-plaintext highlighter-rouge">db.execute</code> is a dictionary. So we can use <code class="language-plaintext highlighter-rouge">registrant.name</code> and <code class="language-plaintext highlighter-rouge">registrant.sport</code> to access the value of each key in each row:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;tbody&gt;</span>
    {% for registrant in registrants %}
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>{{ registrant.name }}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>{{ registrant.sport }}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/deregister"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"{{ registrant.id }}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Deregister"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    {% endfor %}
<span class="nt">&lt;/tbody&gt;</span>
</code></pre></div>    </div>
  </li>
  <li data-marker="*">We can even email users with another library, <code class="language-plaintext highlighter-rouge">flask_mail</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">flask_mail</span> <span class="kn">import</span> <span class="n">Mail</span><span class="p">,</span> <span class="n">Message</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_DEFAULT_SENDER"</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"MAIL_DEFAULT_SENDER"</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_PASSWORD"</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"MAIL_PASSWORD"</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_PORT"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">587</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_SERVER"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"smtp.gmail.com"</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_USE_TLS"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"MAIL_USERNAME"</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"MAIL_USERNAME"</span><span class="p">)</span>
<span class="n">mail</span> <span class="o">=</span> <span class="n">Mail</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôve set some sensitive variables outside of our code, in the IDE‚Äôs environment, so we can avoid including them in our code.</li>
      <li data-marker="*">It turns out that we can provide configuration details like a username and password and mail server, in this case Gmail‚Äôs, to the <code class="language-plaintext highlighter-rouge">Mail</code> variable, which will send mail for us.</li>
    </ul>
  </li>
  <li data-marker="*">Finally, in our <code class="language-plaintext highlighter-rouge">register</code> route, we can send an email to the user:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/register"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"email"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing email"</span><span class="p">)</span>
    <span class="n">sport</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sport</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Missing sport"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sport</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SPORTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Invalid sport"</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="s">"You are registered!"</span><span class="p">,</span> <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">])</span>
    <span class="n">mail</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"success.html"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">In our form, we‚Äôll also need to ask for an email instead of a name:
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Email"</span> <span class="na">type=</span><span class="s">"email"</span><span class="nt">&gt;</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li data-marker="*">Now, if we restart our server and use the form to provide an email, we‚Äôll see that we indeed get one sent to us!</li>
</ul>

<h2 id="sessions">Sessions</h2>

<ul>
  <li data-marker="*"><strong>Sessions</strong> are how web servers remembers information about each user, which enables features like allowing users to stay logged in.</li>
  <li data-marker="*">It turns out that servers can send another header in a response, called <code class="language-plaintext highlighter-rouge">Set-Cookie</code>:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: text/html
Set-Cookie: session=value
...
</code></pre></div>    </div>
    <ul>
      <li data-marker="*"><strong>Cookies</strong> are small pieces of data from a web server that the browser saves for us. In many cases, they are large random numbers or strings used to uniquely identify and track a user between visits.</li>
      <li data-marker="*">In this case, the server is asking our browser to set a cookie for that server, called <code class="language-plaintext highlighter-rouge">session</code> to a value of <code class="language-plaintext highlighter-rouge">value</code>.</li>
    </ul>
  </li>
  <li data-marker="*">Then, when the browser makes another request to the same server, it‚Äôll send back cookies that the same server has set before:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/1.1
Host: gmail.com
Cookie: session=value
</code></pre></div>    </div>
  </li>
  <li data-marker="*">In the real world, amusement parks might give you a hand stamp so you can return after leaving. Similarly, our browser is presenting our cookies back to the web server, so it can remember who we are.</li>
  <li data-marker="*">Advertising companies might set cookies from a number of websites, in order to track users across all of them. In Incognito mode, by contrast, the browser doesn‚Äôt send any cookies set from before.</li>
  <li data-marker="*">In Flask, we can use the <code class="language-plaintext highlighter-rouge">flask_session</code> library to manage this for us:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flask_session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SESSION_PERMANENT"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SESSION_TYPE"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"filesystem"</span>
<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/login"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/login"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span> <span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"login.html"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/logout"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll configure the session library to use the IDE‚Äôs filesystem, and use <code class="language-plaintext highlighter-rouge">session</code> like a dictionary to store a user‚Äôs name. It turns out that Flask will use HTTP cookies for us, to maintain this <code class="language-plaintext highlighter-rouge">session</code> variable for each user visiting our web server. Each visitor will get their own <code class="language-plaintext highlighter-rouge">session</code> variable, even though it appears to be global in our code.</li>
      <li data-marker="*">For our default <code class="language-plaintext highlighter-rouge">/</code> route, we‚Äôll redirect to <code class="language-plaintext highlighter-rouge">/login</code> if there‚Äôs no name set in <code class="language-plaintext highlighter-rouge">session</code> for the user yet, and otherwise show a default <code class="language-plaintext highlighter-rouge">index.html</code> template.</li>
      <li data-marker="*">For our <code class="language-plaintext highlighter-rouge">/login</code> route, we‚Äôll set <code class="language-plaintext highlighter-rouge">name</code> in <code class="language-plaintext highlighter-rouge">session</code> to the form‚Äôs value sent via POST, and then redirect to the default route. If we visited the route via GET, we‚Äôll render the login form at <code class="language-plaintext highlighter-rouge">login.html</code>.</li>
      <li data-marker="*">For the <code class="language-plaintext highlighter-rouge">/logout</code> route, we can clear the value for <code class="language-plaintext highlighter-rouge">name</code> in <code class="language-plaintext highlighter-rouge">session</code> by setting it to <code class="language-plaintext highlighter-rouge">None</code>, and redirect to <code class="language-plaintext highlighter-rouge">/</code> again.</li>
      <li data-marker="*">We‚Äôll also generally need a <code class="language-plaintext highlighter-rouge">requirements.txt</code> that includes the names of libraries we want to use, so they can be installed for our application, but the ones we use here have been preinstalled in the IDE.</li>
    </ul>
  </li>
  <li data-marker="*">In our <code class="language-plaintext highlighter-rouge">login.html</code>, we‚Äôll have a form with just a name:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/login"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Log In"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>

{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">And in our <code class="language-plaintext highlighter-rouge">index.html</code>, we can check if <code class="language-plaintext highlighter-rouge">session.name</code> exists, and show different content:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% extends "layout.html" %}

{% block body %}

    {% if session.name %}
        You are logged in as {{ session.name }}. <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/logout"</span><span class="nt">&gt;</span>Log out<span class="nt">&lt;/a&gt;</span>.
    {% else %}
        You are not logged in. <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/login"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;</span>.
    {% endif %}

{% endblock %}
</code></pre></div>    </div>
  </li>
  <li data-marker="*">When we restart our server, go to its URL, and log in, we can see in the Network tab that our browser is indeed sending a <code class="language-plaintext highlighter-rouge">Cookie:</code> header in the request:<br>
<img src="cookie_header.png" alt="Headers tab for a request with Cookie: session=... among others"></li>
</ul>

<h2 id="store-shows">store, shows</h2>

<ul>
  <li data-marker="*">We‚Äôll look through an example, <a href="https://cdn.cs50.net/2020/fall/lectures/9/src9/store/"><code class="language-plaintext highlighter-rouge">store</code></a>:
    <ul>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">application.py</code> initializes and configures our application to use a database and sessions. In <code class="language-plaintext highlighter-rouge">index()</code>, the default route renders a list of books stored in the database.</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">templates/books.html</code> shows the list of <code class="language-plaintext highlighter-rouge">books</code>, as well as a form that allows us to click ‚ÄúAdd to Cart‚Äù for each of them.</li>
      <li data-marker="*">The <code class="language-plaintext highlighter-rouge">/cart</code> route, in turn, stores an <code class="language-plaintext highlighter-rouge">id</code> from a POST request in the <code class="language-plaintext highlighter-rouge">session</code> variable in a list. If the request used a GET method, however, <code class="language-plaintext highlighter-rouge">/cart</code> would show a list of books with <code class="language-plaintext highlighter-rouge">id</code>s matching the list of <code class="language-plaintext highlighter-rouge">id</code>s stored in <code class="language-plaintext highlighter-rouge">session</code>.</li>
    </ul>
  </li>
  <li data-marker="*">So, ‚Äúshopping carts‚Äù on websites can be implemented with cookies and session variables stored on the server.</li>
  <li data-marker="*">When we view the source generated by our default route, we see that each book has its own <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> element, each with a different <code class="language-plaintext highlighter-rouge">id</code> input that‚Äôs hidden and generated. This <code class="language-plaintext highlighter-rouge">id</code> comes from the SQLite database on our server, and is sent back to the <code class="language-plaintext highlighter-rouge">/cart</code> route.</li>
  <li data-marker="*">We‚Äôll look at another example, <code class="language-plaintext highlighter-rouge">shows</code>, where we can use both JavaScript on the <strong>front-end</strong>, or side that the user sees, and Python on the <strong>back-end</strong>, or server side.</li>
  <li data-marker="*">In <code class="language-plaintext highlighter-rouge">application.py</code> here, we‚Äôll open a database, <code class="language-plaintext highlighter-rouge">shows.db</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">cs50</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="s">"sqlite:///shows.db"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/search"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
    <span class="n">shows</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM shows WHERE title LIKE ?"</span><span class="p">,</span> <span class="s">"%"</span> <span class="o">+</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"q"</span><span class="p">)</span> <span class="o">+</span> <span class="s">"%"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"search.html"</span><span class="p">,</span> <span class="n">shows</span><span class="o">=</span><span class="n">shows</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">The default <code class="language-plaintext highlighter-rouge">/</code> route will show a form, where we can type in some search term.</li>
      <li data-marker="*">The form will use the GET method to send the search query to <code class="language-plaintext highlighter-rouge">/search</code>, which in turn will use the database to find a list of shows that match. Finally, a <code class="language-plaintext highlighter-rouge">search.html</code> template will show the list of shows.</li>
    </ul>
  </li>
  <li data-marker="*">With JavaScript, we can show a partial list of results as we type. First, we‚Äôll use a function called <code class="language-plaintext highlighter-rouge">jsonify</code> to return our shows in the JSON format, a standard format that JavaScript can use.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/search"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
    <span class="n">shows</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM shows WHERE title LIKE ?"</span><span class="p">,</span> <span class="s">"%"</span> <span class="o">+</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"q"</span><span class="p">)</span> <span class="o">+</span> <span class="s">"%"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">shows</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">Now we can submit a search query, and see that we get back a list of dictionaries:<br>
<img src="json.png" alt="Response for search?q=office with list in JSON"></li>
    </ul>
  </li>
  <li data-marker="*">Then, our <code class="language-plaintext highlighter-rouge">index.html</code> template can convert this list to elements in the DOM:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"initial-scale=1, width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>shows<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">autofocus</span> <span class="na">placeholder=</span><span class="s">"Query"</span> <span class="na">type=</span><span class="s">"search"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;ul&gt;&lt;/ul&gt;</span>

        <span class="nt">&lt;script </span><span class="na">crossorigin=</span><span class="s">"anonymous"</span> <span class="na">integrity=</span><span class="s">"sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="</span> <span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.5.1.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script&gt;</span>

            <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">input</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyup</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/search?q=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shows</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
                  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">shows</span><span class="p">)</span>
                  <span class="p">{</span>
                      <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">shows</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">title</span><span class="p">;</span>
                      <span class="nx">html</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">&lt;li&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;/li&gt;</span><span class="dl">'</span><span class="p">;</span>
                  <span class="p">}</span>

                  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
                <span class="p">});</span>
            <span class="p">});</span>

        <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
    <ul>
      <li data-marker="*">We‚Äôll use another library, JQuery, to make requests more easily.</li>
      <li data-marker="*">We‚Äôll listen to changes in the <code class="language-plaintext highlighter-rouge">input</code> element, and use <code class="language-plaintext highlighter-rouge">$.get</code>, which calls a JQuery library function to make a GET request with the input‚Äôs value. Then, the response will be passed to an anonymous function as the variable <code class="language-plaintext highlighter-rouge">shows</code>, which will set the DOM with generated <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code> elements based on the response‚Äôs data.</li>
      <li data-marker="*"><code class="language-plaintext highlighter-rouge">$.get</code> is an <strong>AJAX</strong> call, which allows for JavaScript to make additional HTTP requests after the page has loaded, to get more data. If we open the Network tab again, we can indeed see that each key we pressed made another request, with a response:<br>
<img src="ajax.png" alt="Network tab with requests for search?q=of, search?q=off, etc. and Response with JSON"></li>
      <li data-marker="*">Since the network request might be slow, the anonymous function we pass to <code class="language-plaintext highlighter-rouge">$.get</code> is a <strong>callback</strong> function, which is only called after we get a response from the server. In the meantime, the browser can run other JavaScript code.</li>
    </ul>
  </li>
  <li data-marker="*">That‚Äôs it for today!</li>
</ul>


                </main>

            </div>

        </div>

        
 
    


</body></html>